{% extends 'base.html' %}
{% load static %}

{% block active %}
    {% with active='home' %}{{ block.super }}{% endwith %}
{% endblock %}


{% block title %}
    <title>The Beatles | Home</title>
{% endblock %}

{% block content %}

    <form class="form-inline mt-5" action="" method="POST">
        {% csrf_token %}
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Search...">
            <button type="submit" class="btn" style="padding:0px;margin-left:5px;"><span class="input-group-text" id="basic-addon2"><i class="bi bi-search" style="color:#5DC95B;"></i></span></button>
        </div>
    </form>
    <div style="">
        <div id="map" style="width: 50%; height: 400px;margin-left: auto;margin-right: auto;">
    </div>
    </div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxEhJzSEW4WQOINMyTdUblD0w5WRd-n4w&callback=initMap&v=weekly" defer></script>
<script>
    // Note: This example requires that you consent to location sharing when
    // prompted by your browser. If you see the error "The Geolocation service
    // failed.", it means you probably did not give permission for the browser to
    // locate you.

    let map, infoWindow;

    var lat = '';
    var lon = '';

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: -34.397, lng: 150.644 },
            zoom: 6,
        });

        infoWindow = new google.maps.InfoWindow();

        const locationButton = document.createElement("button");
        locationButton.style.display = "none";
        map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);

        locationButton.addEventListener("click", () => {
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        lat = position.coords.latitude;
                        lon = position.coords.longitude;
                        // alert(lat);
                        // alert(lon);
                        infoWindow.setPosition(pos);
                        infoWindow.setContent("Location found.");
                        infoWindow.open(map);
                        map.setCenter(pos);
                    },
                    () => {
                        handleLocationError(true, infoWindow, map.getCenter());
                    },
                );
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }, false);
        locationButton.click();
    }

    async function readJson(url) {
        var requestOptions = {
            'content-type': 'application/json',
            method: 'GET',
            redirect: 'follow',
            "Access-Control-Allow-Origin" : "*",
            "Access-Control-Allow-Credentials" : true,
            mode: "no-cors"
        };

        const response = await fetch(url, {mode: "no-cors"});
        const json = await response.json();
        return json;
    }


    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(
            browserHasGeolocation
                ? "Error: The Geolocation service failed."
                : "Error: Your browser doesn't support geolocation.",
            );
        infoWindow.open(map);
    }

window.initMap = initMap;
</script>
{% endblock content %}
